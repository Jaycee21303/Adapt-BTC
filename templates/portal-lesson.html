{% include 'components/header.html' %}
<link rel="stylesheet" href="{{ url_for('portal.static', filename='css/portal.css') }}">
<div class="navbar">
  <div>{{ course.title }}</div>
  <div>
    <a href="{{ url_for('portal.dashboard') }}">Dashboard</a>
    <a href="{{ url_for('portal.course_detail', course_id=course.id) }}">Lessons</a>
    <a href="{{ url_for('portal.logout') }}">Logout</a>
  </div>
</div>
<div class="container">
  <div class="dashboard-grid">
    <div class="card" style="grid-column: span 1; min-width: 260px;">
      <h3>Lessons</h3>
      <ul>
        {% for item in lessons %}
        <li>
          <a href="{{ url_for('portal.lesson', course_id=course.id, order=item.lesson_order) }}">Lesson {{ item.lesson_order }}: {{ item.title }}</a>
          {% if item.lesson_order in completed_lessons %}<span>âœ…</span>{% endif %}
        </li>
        {% endfor %}
      </ul>
      <a class="btn" href="{{ url_for('portal.quiz', course_id=course.id) }}">Take Quiz</a>
    </div>
    <div class="card" style="grid-column: span 2;">
      {% if current_lesson %}
      <h3>Lesson {{ current_lesson.lesson_order }}: {{ current_lesson.title }}</h3>
      {% for paragraph in current_lesson.content.split('\n\n') %}
      <p>{{ paragraph }}</p>
      {% endfor %}
      <h4>Examples</h4>
      <ul>
        {% for example in current_lesson.examples.split('\n') %}
        <li>{{ example }}</li>
        {% endfor %}
      </ul>
      <h4>Glossary</h4>
      <ul>
        {% for item in current_lesson.glossary.split('\n') %}
        {% set parts = item.split(':') %}
        <li><strong>{{ parts[0] }}:</strong> {{ parts[1] }}</li>
        {% endfor %}
      </ul>
      <h4>Key Takeaways</h4>
      <ul>
        {% for take in current_lesson.takeaways.split('\n') %}
        <li>{{ take }}</li>
        {% endfor %}
      </ul>
      <div class="diagram">{{ current_lesson.diagram|safe }}</div>
      <div class="lesson-nav">
        {% if prev_next[0] %}
        <a class="btn secondary" href="{{ url_for('portal.lesson', course_id=course.id, order=prev_next[0]) }}">Previous</a>
        {% endif %}
        <form id="complete-form" method="post" action="{{ url_for('portal.complete_lesson', course_id=course.id, order=current_lesson.lesson_order) }}">
          <button class="btn" type="button" onclick="markLessonComplete('complete-form')">Mark Complete</button>
        </form>
        {% if prev_next[1] %}
        <a class="btn" href="{{ url_for('portal.lesson', course_id=course.id, order=prev_next[1]) }}">Next</a>
        {% endif %}
      </div>
      {% else %}
      <p>Select a lesson to begin.</p>
      {% endif %}
    </div>
  </div>
</div>
<script src="{{ url_for('portal.static', filename='js/portal.js') }}"></script>
{% include 'components/footer.html' %}
